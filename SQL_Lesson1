--схема БД: https://docs.google.com/document/d/1NVORWgdwlKepKq_b8SPRaSpraltxoMg2SIusTEN6mEQ/edit?usp=sharing
--colab/jupyter: https://colab.research.google.com/drive/1j4XdGIU__NYPVpv74vQa9HUOAkxsgUez?usp=sharing

-- Задание 1: Вывести name, class по кораблям, выпущенным после 1920
--
select name,class from ships where launched>1920
-- Задание 2: Вывести name, class по кораблям, выпущенным после 1920, но не позднее 1942
--
select name,class from ships where launched>1920 and launched<=1942
-- Задание 3: Какое количество кораблей в каждом классе. Вывести количество и class
select c.class,count(*) from classes c
left join ships s on s.class=c.class
group by c.class
order by c.class
-- Задание 4: Для классов кораблей, калибр орудий которых не менее 16, укажите класс и страну. (таблица classes)
--
select class,country from classes where bore>=16
-- Задание 5: Укажите корабли, потопленные в сражениях в Северной Атлантике (таблица Outcomes, North Atlantic). Вывод: ship.
--select * from outcomes order by ship
select ship from outcomes where result='sunk' and battle='North Atlantic'
-- Задание 6: Вывести название (ship) последнего потопленного корабля
--
select  ship from outcomes o 
join battles b on b.name=o.battle
where o.result='sunk' and b.date=(select max(date) from outcomes o 
join battles b on b.name=o.battle
where o.result='sunk' )
-- Задание 7: Вывести название корабля (ship) и класс (class) последнего потопленного корабля
--
--select * from ships order by name

select ship, coalesce(class,'отсутствует информация') as class from outcomes o 
join battles b on b.name=o.battle
left join ships s on s.name=o.ship
where o.result='sunk' and b.date=(select max(date) from outcomes oo 
join battles bb on bb.name=oo.battle
where oo.result='sunk' )
-- Задание 8: Вывести все потопленные корабли, у которых калибр орудий не менее 16, и которые потоплены. Вывод: ship, class
--
--select * from outcomes where result='sunk'
/*select * from classes c
left join ships s on c.class=s.class
where name in ('Bismarck','Fuso','Hood','Kirishima','Schamhorst','Yamashiro')
 or c.class in ('Bismarck','Fuso','Hood','Kirishima','Schamhorst','Yamashiro')
*/
select o.ship,c.class from outcomes o 
left join battles b on b.name=o.battle
full join ships sh on sh.name=o.ship
full  join classes c on c.class =sh.class or o.ship=c.class
where o.result='sunk' and c.bore >=16
-- Задание 9: Вывести все классы кораблей, выпущенные США (таблица classes, country = 'USA'). Вывод: class
--
select distinct c.class from classes c 
where c.country='USA'
-- Задание 10: Вывести все корабли, выпущенные США (таблица classes & ships, country = 'USA'). Вывод: name, class
select distinct sh.name,c.class from classes c 
join ships sh on sh.class=c.class
where c.country='USA'
order by c.class,sh.name
